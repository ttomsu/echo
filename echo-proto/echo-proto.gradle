plugins {
  id 'de.undercouch.download' version '4.0.0'
}

apply plugin: 'java'
apply plugin: 'com.google.protobuf'

task downloadProtos(type: Download) {
  src 'https://raw.githubusercontent.com/spinnaker/stats/master/proto/stats/log.proto'
  dest "$projectDir/src/main/proto/log.proto"
  overwrite true
}

dependencies {
  implementation 'com.google.protobuf:protobuf-java:3.9.1'
}

protobuf {
    protoc {
        artifact = 'com.google.protobuf:protoc:3.9.1'
    }
}

tasks.getByName("assemble").dependsOn(downloadProtos)

idea {
    module {
        generatedSourceDirs += file("${protobuf.generatedFilesBaseDir}/main/java")
    }
}
